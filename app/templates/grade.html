{% extends "main.html" %}
{% block content1 %}

<section class="content">
  <h3>Grade</h3>
  <small>Good luck.</small>
  <hr>
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-filled">
          <div class="panel-body">
            <div class="col-md-3 col-xs-6 text-center"><h2 class="no-margins">4.00</h2>MAX</div>
            <div class="col-md-3 col-xs-6 text-center"><h2 class="no-margins">3.45</h2>GPAX</div>
            <div class="col-md-3 col-xs-6 text-center"><h2 class="no-margins">3.45</h2>GPA</div>
            <div class="col-md-3 col-xs-6 text-center"><h2 class="no-margins">122</h2>Weight</div>
          </div>
        </div>
      </div>
    </div>
  <br>
  <div class="row">
    {% for year_and_semester in year_semester %}
      <div class="panel panel-filled">
        <div class="panel-heading">
          <div class="panel-tools">
            <a class="panel-toggle"><i class="fa fa-chevron-up"></i></a>
          </div>
          <h3>Year <span>{{year_and_semester[0]}}</span> Semester <span>{{year_and_semester[1]}}</span>  </h3>
        </div>

        <div class="panel-body">
          <table class="table table-responsive table-condensed">
            <thead>
              <tr>
                <th class="col-md-1">COURSE NO</th>
                <th colspan="4">COURSE TITLE</th>
                <th class="col-md-1">CREDIT</th>
                <th class="col-md-1">GRADE</th>
              </tr>
              </thead>
              <tbody>
                {% for course in registered_course_dict[(year_and_semester[0],year_and_semester[1])] %}
                  <tr>
                    <td>{{course.course_id}}</td>
                    <td colspan="4">{{registered_course_name_dict[course.course_id][0]}}</td>
                    <td>{{registered_course_name_dict[course.course_id][1]}}</td>
                    <td>{{course.grade}}</td>
                  </tr>
                {% endfor %}
              </tbody>
              {%set grade_ready = True %}

              {# {% for c in registered_course_dict[(year_and_semester[0],year_and_semester[1])] %}
                {%if c.grade is not defined %}
                  {% set grade_ready = False %}
                {% endif %}
              {% endfor %}

              {% set sum_of_grade = 0 %}
              {% set course_count = 0 %}
              {% if grade_ready %}
                {% for c in registered_course_dict[(year_and_semester[0],year_and_semester[1])] %}
                    {% set sum_of_grade = sum_of_grade + c.grade %}
                    {% set course_count = course_count + 1 %}
                {% endfor %}
                {%set GPA = sum_of_grade/course_count %}
              {% endif %} #}
              <tfoot>
                <tr>
                  <td class="col-md-1"></td>
                  <td class="col-md-1"></td>
                  <td class="col-md-1"></td>
                  <td class="col-md-1"></td>
                  <td class="col-md-1"></td>
                  <td class="col-md-1">GPA: <span id="gpa{{year_and_semester[0]}}-{{year_and_semester[1]}}"></span></td>
                  <td class="col-md-1">GPAX: <span></span></td>
                </tr>
              </tfoot>
          </table>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="row" style="text-align: end;">
    <a href="/transcript"><button class="btn btn-success btn-xs">Transcript</button></a>
  </div>


  <hr>
  <small>CA   = CREDIT ATTEMPTED <br>

      CG   = CREDIT GRANTED<br>

      GPA = GRADE POINT AVERAGE<br>

      CAX   = CUMULATIVE CA<br>

      CGX   = CUMULATIVE CG<br>

      GPAX = CUMULATIVE GPA<br>

      GPX = CUMULATIVE GP<br>

      </small>
  </div>
</section>
<script>
{% for year_and_semester in year_semester %}
var gpa{{year_and_semester[0]}}_{{year_and_semester[1]}} = 0;
var gradeReady{{year_and_semester[0]}}_{{year_and_semester[1]}} = true;
  {% for course in registered_course_dict[(year_and_semester[0],year_and_semester[1])] %}
  {% if course.grade is not none %}
  gpa{{year_and_semester[0]}}_{{year_and_semester[1]}} += {{course.grade/registered_course_dict[(year_and_semester[0], year_and_semester[1])]|length}};
  {% else %}
  gradeReady{{year_and_semester[0]}}_{{year_and_semester[1]}} = false;
  {% endif %}
  {% endfor %}
if(gradeReady{{year_and_semester[0]}}_{{year_and_semester[1]}}){
  console.log($("#gpa{{year_and_semester[0]}}-{{year_and_semester[1]}}").text());
  $("#gpa{{year_and_semester[0]}}-{{year_and_semester[1]}}").text(gpa{{year_and_semester[0]}}_{{year_and_semester[1]}}.toString());
}
else{
  console.log($("#gpa{{year_and_semester[0]}}-{{year_and_semester[1]}}").text());
  $("#gpa{{year_and_semester[0]}}-{{year_and_semester[1]}}").text("Not ready");
}
{% endfor %}
</script>


{% endblock %}
